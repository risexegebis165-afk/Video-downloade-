<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway Downloader Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-10">
    <div class="w-full max-w-2xl bg-white p-8 rounded-lg shadow-md">
        <h1 class="text-3xl font-bold text-center mb-6 text-blue-600">Video Downloader</h1>
        
        <div class="flex gap-2 mb-8">
            <input type="text" id="videoUrl" placeholder="Paste link here..." class="flex-1 p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button onclick="fetchDetails()" id="btn" class="bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 transition">Fetch</button>
        </div>

        <div id="result" class="hidden">
            <h2 id="title" class="text-xl font-semibold mb-4 text-center"></h2>
            <div class="flex flex-col md:flex-row gap-4 items-center">
                <img id="thumb" class="w-full md:w-1/2 rounded-lg shadow">
                <div class="w-full">
                    <video id="preview" controls class="w-full rounded mb-4"></video>
                    
                    <label class="block mb-2 font-medium">Select Quality & Format:</label>
                    <select id="formatSelect" class="w-full p-2 border border-gray-300 rounded mb-4"></select>
                    
                    <button onclick="downloadFile()" class="w-full bg-green-600 text-white py-3 rounded-md font-bold hover:bg-green-700">Download Now</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function fetchDetails() {
            const url = document.getElementById('videoUrl').value;
            const btn = document.getElementById('btn');
            btn.innerText = 'Loading...';
            
            const formData = new FormData();
            formData.append('url', url);

            const res = await fetch('/fetch', { method: 'POST', body: formData });
            const data = await res.json();
            
            btn.innerText = 'Fetch';
            if(data.error) return alert("Failed to fetch!");

            document.getElementById('result').classList.remove('hidden');
            document.getElementById('title').innerText = data.title;
            document.getElementById('thumb').src = data.thumbnail;
            document.getElementById('preview').src = data.video_preview;

            const select = document.getElementById('formatSelect');
            select.innerHTML = '';
            data.formats.forEach(f => {
                const opt = document.createElement('option');
                opt.value = f.url;
                opt.innerText = `${f.type} - ${f.quality} (${f.ext})`;
                select.appendChild(opt);
            });
        }

        function downloadFile() {
            const downloadUrl = document.getElementById('formatSelect').value;
            window.open(downloadUrl, '_blank');
        }
    </script>
</body>
</html>
